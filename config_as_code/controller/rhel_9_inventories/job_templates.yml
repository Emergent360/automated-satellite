---
controller_templates:
  - name: SATELLITE / RHEL - Publish Content View
    project: Automated Management
    playbook: satellite_publish.yml
    inventory: Workshop Inventory
    credentials:
      - Satellite Credential
    extra_vars:
      env: Dev
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Select Content View
          variable: content_view
          type: multiplechoice
          choices: "{{ hostvars['satellite.example.com']['satellite_content_views'] | selectattr('name', 'match', '^RHEL.*$') | map(attribute='name') | list + hostvars['ansible-1.example.com']['satellite_content_views'] | selectattr('name', 'match', '^RHEL.*$') | map(attribute='name') | list }}"
          required: true

  - name: CONTROLLER / Update inventories via dynamic sources
    project: Automated Management
    playbook: controller_inventory_source_update.yml
    inventory: Workshop Inventory
    credentials:
      - Controller Credential
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory to update
          variable: content_view
          type: multiplechoice
          choices: "{{ hostvars['satellite.example.com']['satellite_content_views'] | selectattr('name', 'defined') | map(attribute='name') | list + hostvars['ansible-1.example.com']['satellite_content_views'] | selectattr('name', 'match', '^RHEL.*$') | map(attribute='name') | list }}"
          required: true
        - question_name: Choose Environment
          type: multiplechoice
          variable: env
          choices:
            - Dev
            - QA
            - Prod
          required: true

  - name: LEAPP / 01 Analysis
    project: Automated Management
    playbook: leapp_analysis.yml
    inventory: EC2 Dynamic Inventory
    credentials:
      - Workshop Credential
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory group
          type: multiplechoice
          variable: dynamic_inventory_group
          choices: "{{ hostvars['satellite.example.com']['satellite_lifecycle_environments'] | selectattr('name', 'match', '^RHEL8.*$') | map(attribute='name') | list}}"
          required: true
        - question_name: Leapp target version
          type: multiplechoice
          variable: leapp_target_version
          choices:
            - '8.8'
            - '9.2'
          required: true
    ask_limit_on_launch: true

  - name: LEAPP / 03 Rollback
    description: Revert node snapshot - selection via dynamic inventory group
    project: Automated Management
    playbook: snapshot_instance_lvm.yml
    inventory: EC2 Dynamic Inventory
    credentials:
      - Workshop Credential
    extra_vars:
      snapshot_set_name: snap01
      snapshot_create_boot_backup: true
      lvm_snapshots_action: revert
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory group
          type: multiplechoice
          variable: dynamic_inventory_group
          choices: "{{ hostvars['satellite.example.com']['satellite_lifecycle_environments'] | selectattr('name', 'match', '^RHEL8.*$') | map(attribute='name') | list }}"
          required: true
    ask_variables_on_launch: true
    ask_limit_on_launch: true
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry

  - name: OS / Upgrade
    project: Automated Management
    playbook: leapp_upgrade.yml
    inventory: EC2 Dynamic Inventory
    credentials:
      - Workshop Credential
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Select inventory group
          type: multiplechoice
          variable: dynamic_inventory_group
          choices: "{{ hostvars['satellite.example.com']['satellite_lifecycle_environments'] | selectattr('name', 'match', '^RHEL8.*$') | map(attribute='name') | list }}"
          required: true
    extra_vars:
      leapp_upgrade_type: satellite
      satellite_organization: 'Default_Organization'
      satellite_activation_key_pre_leapp: 'RHEL8_Dev'
      satellite_activation_key_leapp: 'RHEL8IPU_Dev'
      satellite_activation_key_post_leapp: 'RHEL9_Dev'
      leapp_repos_enabled:
        - !unsafe 'satellite-client-6-for-rhel-{{ ansible_distribution_major_version | int + 1 }}-x86_64-rpms'
      leapp_upgrade_opts: '--target 9.2'
    ask_variables_on_launch: true
    ask_limit_on_launch: true
...
